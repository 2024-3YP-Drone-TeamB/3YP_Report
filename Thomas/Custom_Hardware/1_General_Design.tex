\subsection{Design Considerations}

\subsubsection{Trace Lengths}
\paragraph{Signal Integrity and Timing}
All traces have propagation delay that increases linearly with length meaning that the longer the trace, the longer the delay. Furthermore, noise increases due to impurities and crosstalk. Therefore, traces should be kept as short as possible. This means that large footprint devices are placed at the edges and the \gls{MCU} is placed centrally.
\paragraph{Length Matching}
In synchronous communication methods the clock signal must be in sync with the data transmission. This means that the lines should be as similar in length as possible so that they arrive at the same delay. The faster the communication rate the stricter this must become as the clock signal frequency is increased.
\paragraph{Effect of vias}
Vias allow for the transference of signals between planes which is necessary for routing signals. However, they should be avoided as they introduce extra impedance, noise and delay. Furthermore, for synchronous high speed signals they should be included in trace length considerations as the line with fewer vias should be tuned to have a longer length to achieve the same delay.

\subsubsection{Circuit Protection}
\paragraph{\gls{ESD}}
\gls{ESD} occurs when there is a significant static charge built up in a ground operator or contacting surface that is then shorted in contact with the board. As electro-static voltages can be as high as 20 kV from just opening a plastic bag \footnote{\url{https://www.ti.com/document-viewer/lit/html/SSZT871}}, this can cause significant damage to devices due to transient current spikes.
\paragraph{Touch Protection Devices}
In order to protect against \gls{ESD} the circuit must provide a low resistance pathway to the ground. This can be using \gls{TVS} diodes that above certain voltages act like a wire that diverts the current flow\footnote{\url{https://resources.altium.com/p/pcb-design-guidelines-using-tvs-diode-transient-protection}}. They can also be mitigated using voltage dependent resistors that increase resistance with voltage, preventing current spikes. In my designs I make use of bidirectional \gls{TVS} diodes due to their price and simplicity. 
\paragraph{Over current protection}
Fuses and resistors are the best way to protect a device against short circuits. Series resistors mitigate the peak current therefore, for serial debugging I ensured that all connections direct to the \gls{MCU} have series resistors in case of accidental short circuits by the user. However, fuses are the best way to protect against short circuits. This is because, series resistors dissipate too much power to be efficient in power transfer lines, therefore 5A fuses are used in the power lines of both modules. 
\paragraph{Placement}
Protections should be as close to possible sources so the least number of components and wires get damaged in failure. Therefore, all \gls{TVS} diodes are placed near touched areas or interfaces, series resistors are placed as close as possible to prevent wire transients and fuses are placed before the power is connected to the power and ground planes.

\subsubsection{Component Placement}
\paragraph{Utility Regions}
Components with similar functionalities should be restricted to specific regions, this is because it reduces trace length, prevents interference between high and low frequency signals and makes thermal management easier. These regions for the custom designed hardware are shown in \ref{fig:custom_hardware_overview}.
\paragraph{Thermal Considerations}
Heat dissipating elements, typically diodes and resistors, can cause damage to electronic component, therefore, heat sinks or controlled airflows are sometimes required. This consideration is why on my devices Buck Converters of above 90\% are used instead of the less efficient \gls{LDO} which would have an efficiency of 66\% when converting from 5V to 3.3V. This, in addition to the low power draws of all other components, means that no explicit thermal management is needed.

\subsubsection{Trace Widths and Spacing}
\paragraph{Impedance Control}
 Since the trace thickness standard as one ounce per square foot it is the cheapest to manufacture with and is used throughout my designs. Therefore, to control the impedance of a trace the width must be selected. I did this using an online calculator\footnote{\url{https://www.advancedpcb.com/en-us/tools/trace-width-calculator/}}, setting the expectable temperature rise to 10\degree C, a trace of width 12 mil (0.3048mm) can handle up to 1A and a trace width of 6 mil (0.1528mm) can handle up over 0.6A. Given that traces below 6 mil incur extra manufacturing cost\footnote{\url{https://www.pcbway.com/pcb_prototype/PCB_Design_Rule_Check.html}} for low current signals 6 mil traces are used, for high current traces 12 mil traces are used.
\paragraph{Crosstalk}
When traces are too close too each other they can induce signals in each other, this causes inaccuracies that can cause Analogue to Digital converter to have bit errors\footnote{\url{https://resources.altium.com/p/crosstalk-basics-pcb-design?}}. However, since all the signals are digital or physically isolated on the board this is not a major concern but I did ensure that all traces are at least 12 mil separated as a form of best practice. Furthermore, the Radio Frequency input for the \gls{GNSS} module is kept away from all other components and the ground and voltage planes as shown in \ref{fig:gnss_render}).

\subsubsection{Layers}
\paragraph{Two Layers}
The simplest and most cost effective option in \gls{PCB} design is two copper layers separated by a dielectric. By using a copper filled regions you can create a ground plane and a power plane that effectively distribute charge and maintain voltage integrity. The simplicity of the \gls{GNSS} module means that two layers is the best option. This comes at the cost of more difficult component placement and a slightly less stable power and ground plane. To mitigate the instability, distributed ceramic capacitors between the planes that filter high frequency noise in voltage levels, maintaining integrity. These capacitors are best placed next to sensors and processers to ensure stable, low noise readings.
\paragraph{Four or More Layers}
When circuits become more complex, a purpose ground and power plane in between the top and bottom plane can allow for greater packing density of components. They also make the planes more stable as all the path impedances are very low. This means that for complex designs with many sensors, like the flight controller module, four layer \gls{PCB}s are the best option. Furthermore, if the complexity of the design is greater you can add further ground and power planes for analogue signals, high frequency signals or for regular signals to support greater component density.

\subsection{Debugging}
\paragraph{Technical Debugging}
There easy to use male pin headers in both designs shown in \ref{fig:custom_hardware_overview} so that a \gls{SWD} debugger can be connected, furthermore, for signalling debugging the detachable ports for the \gls{CAN} bus mean a debugging computer can simply connect. This is so technically skilled operators can inspect system level signals and specific board operations.
\paragraph{Field Debugging}
The use of technical debugging experts should always be avoided if possible to reduce capital expenditure and delay. Therefore the custom flight controller has a simple 4 \gls{LED} array for basic error codes that can isolate the problem so it can be fixed or so that only a specific, replaceable component, can be sent for repair and switched out with a backup. These codes are shown in \ref{tab:error_codes} where the colours are the \gls{LED}s and the x denotes blinking, the null state is a solid green \gls{LED} only.  The inclusion of the green LED has three key purposes: firstly, it blinks to denote between modules, secondly it gives clear visualisation that no tests have failed and lastly it ensures the codes are red in the right order no matter the orientation. It is also a different brightness to the red \gls{LED}s allowing for use by colour-blind operators in line with the inclusion objectives of the project.
\input{Thomas/Custom_Hardware/error_codes}
\paragraph{Post Failure Analysis}
If there is a crash that causes significant damage, and due to the volatile nature of \gls{RAM} memory, some failures cannot be detected directly with the device. Therefore, the flight controller has a removable microSD card to record flight data. In addition, the backup power supply, as seen in \ref{fig:custom_hardware_overview}, provides enough power that even in complete failure it can write the final few error messages. Therefore, this can be retrieved, downloaded and sent for analysis quickly to find the source of failure.